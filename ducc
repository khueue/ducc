#!/usr/bin/env escript
%%! -pa ebin

usage() ->
    io:write('Usage: ducc [file]~n'),
    io:write('Uses stdin/stdout if no file given.~n').

main([]) ->
    compile_standard_input();
main([File]) ->
    compile_file(File);
main(_) ->
    usage().

compile_standard_input() ->
    compile_stream(standard_io).

compile_file(File) ->
    {ok, Stream} = file:open(File, [read]),
    compile_stream(Stream),
    file:close(Stream).

compile_stream(Stream) ->
    String = io_tools:string_from_stream(Stream),
    Tokens = lexer_driver:tokenize(String),
    ParseTree = parser_driver:parse(Tokens),
    io_tools:term_to_output(ParseTree).
